var React = require("react");
var withSideEffect = require('react-side-effect');

var Font = React.createClass({
  render: function(){
    return null;
  }
})

Font.propTypes = {
  fonts: React.PropTypes.array.isRequired
};

function reducePropsToState(propsList) {
  var fonts = [];
  propsList.forEach(function (props) {
    props.font && fonts.push(props.font);
    props.fonts && props.fonts.forEach(function(font){
      fonts.push(font);
    })
  });
  return fonts;
}

function handleStateChangeOnClient(fonts) {
  var head = document.getElementsByTagName("head")[0];

  fonts.forEach(function(font, i){
    if(!document.getElementById(font.id)) {
      var link = document.createElement("link");
      link.setAttribute("rel", "stylesheet");
      link.setAttribute("data-font", "true");
      link.setAttribute("type", "text/css");
      link.setAttribute("href", font.href);
      link.setAttribute("id", font.id);
      head.appendChild(link);
    }
  })
}

var FontWithSideEffect = withSideEffect(
  reducePropsToState,
  handleStateChangeOnClient
)(Font)

module.exports = FontWithSideEffect;
